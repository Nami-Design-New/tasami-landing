<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required Meta Tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no" />
    <meta name="theme-color" content="#8e24aa" />

    <!-- SEO Meta -->
    <meta name="title" content="" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph Meta -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="" />
    <meta property="og:title" content="" />
    <meta property="og:description" content="" />
    <meta property="og:image" content="images/logo.png" />

    <!-- Twitter Meta -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:image" content="images/logo.png" />

    <!-- Icons -->
    <link rel="apple-touch-icon" href="images/logo.png" />
    <link rel="icon" href="images/fav.svg" type="image/svg+xml" />

    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/style.css" />

    <!-- Title -->
    <title>تســامــى | منصة مبتكرة لتحقيق الأهداف الشخصية بأساليب اجتماعية محفزة</title>
</head>

<body>
    <header>
        <nav class="container">
            <a class="logo" href="index.html">
                <img src="images/logo.png" alt="تسامي">
            </a>

            <ul class="nav_links">
                <li><a href="index.html">الرئيسية</a></li>
                <li><a href="#why">لماذا تختار تسامي ؟</a></li>
                <li><a href="#how">كيف تعمل تسامي ؟</a></li>
                <li><a href="#join">انضم الينا</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero_section">
            <video src="images/intro.mp4" autoplay muted loop playsinline></video>
            <div class="content">
                <div data-aos="fade-up">
                    <h1>مرحباً بك في منصة "تسامي"</h1>
                    <p>اختيارك الذكي لتحقيق أهدافك الشخصية والمهنية بأسلوب اجتماعي فعال وأدوات عمل احترافية</p>
                </div>

                <div data-aos="fade-up">
                    <h3>كن مستعداً لتجربة ملهمة! واكتشف بنفسك كيف</h3>
                    <i>#نساعدك_لتسمو </i>
                </div>
            </div>
        </section>

        <section class="why_section" id="why">
            <div class="container">
                <div class="row">
                    <div class="col-12 p-2 mb-5" data-aos="fade-up">
                        <h2>لماذا "تسامي"؟</h2>
                        <p>!! ليست مجرد منصة رقمية لزيادة الانتاجية !!</p>

                        <h5>"تسامي" مجتمع فريد من نوعه، صمم بعناية ليمنحك تجربة اجتماعية شيقة - ستوفر لك:</h5>
                    </div>

                    <div class="col-lg-3 col-md-6 col-12 p-3" data-aos="fade-up">
                        <div class="why_card">
                            <img src="images/why1.png" alt="why1">

                            <h6>تحقيق أهدافك بثقة</h6>
                            <p>واجه تحدياتك بخطوات واضحة ومساعدة متواصلة مع كل خطوة</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12 p-3" data-aos="fade-up">
                        <div class="why_card">
                            <img src="images/why2.png" alt="why1">

                            <h6>تحقيق أهدافك بثقة</h6>
                            <p>واجه تحدياتك بخطوات واضحة ومساعدة متواصلة مع كل خطوة</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12 p-3" data-aos="fade-up">
                        <div class="why_card">
                            <img src="images/why3.png" alt="why1">

                            <h6>تحقيق أهدافك بثقة</h6>
                            <p>واجه تحدياتك بخطوات واضحة ومساعدة متواصلة مع كل خطوة</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12 p-3" data-aos="fade-up">
                        <div class="why_card">
                            <img src="images/why4.png" alt="why1">

                            <h6>تحقيق أهدافك بثقة</h6>
                            <p>واجه تحدياتك بخطوات واضحة ومساعدة متواصلة مع كل خطوة</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="business_model">
            <div class="container">
                <div class="row">
                    <div class="col-12 p-2">
                        <h4 data-aos="fade-up">نموذج عمل مبتكر!</h4>
                        <p data-aos="fade-up">تقدم "تسامي" نموذج عمل متكامل، يدمج ثلاث ممارسات ناجحة في قالب واحد مبتكر!
                        </p>
                    </div>

                    <div class="col-lg-4 col-12 p-3" data-aos="fade-up">
                        <div class="model_card">
                            <img src="images/model1.png" alt="model">
                            <h6>تحقيق الأهداف</h6>
                            <p>تطبيق الأهداف الذكية SMART</p>
                        </div>
                    </div>
                    <div class="col-lg-4 col-12 p-3" data-aos="fade-up">
                        <div class="model_card">
                            <div class="model_card">
                                <img src="images/model2.png" alt="model">
                                <h6>تنمية الجدارات</h6>
                                <p>بناء الجدارات بنموذج 70-20-10</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-12 p-3" data-aos="fade-up">
                        <div class="model_card">
                            <div class="model_card">
                                <img src="images/model3.png" alt="model">
                                <h6>التعلم الاجتماعي</h6>
                                <p>توظيف ممارسات التعلم الإجتماعي SLT</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="how_it_works" id="how">
            <div class="container">
                <div class="row">
                    <h2 data-aos="fade-up">كيف تعمل "تسامي"!!</h2>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="blob_container">
                            <div class="blob right">
                                <img src="images/1.png" alt="how1">
                            </div>
                            <h5>
                                أنت في حيرة! لديك هدف شخصي واعد ترغب بتحقيقه أو مهمة عاجلة لتنجزها، وتحتاج إلى مساعدة
                                متخصصة واحترافية!
                            </h5>
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="arrow d-none d-md-block">
                            <img src="images/arrow_left.png" alt="arrow">
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="arrow d-none d-md-block">
                            <img src="images/arrow_right.png" alt="arrow">
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="blob_container">
                            <div class="blob left">
                                <img src="images/2.png" alt="how1">
                            </div>
                            <h5>
                                الأمر سهل للغاية! اعرض هدفك أو اطلب المساعدة لانجاز المهمة من مجتمع "تسامي"، وقيم العروض
                                من المساعدين الشخصيين المؤهلين
                            </h5>
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="blob_container">
                            <div class="blob left">
                                <img src="images/3.png" alt="how1">
                            </div>
                            <h5>
                                عند الاتفاق، سيعمل المساعد الشخصي معك لوضع وتنفيذ خطة رائعة معززة بالذكاء الصناعي لتحقيق
                                هدفك
                            </h5>
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="arrow d-none d-md-block">
                            <img src="images/arrow_left.png" alt="arrow">
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="arrow d-none d-md-block">
                            <img src="images/arrow_right.png" alt="arrow">
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="blob_container">
                            <div class="blob left">
                                <img src="images/4.png" alt="how1">
                            </div>
                            <h5>
                                ستكون رحلتك نحو الانجاز ممتعة، فأنت تتقدم بثقة ضمن مجموعة من الطموحين اللذين يشاركونك
                                نفس الاهتمامات يمنحونك فرصاً للتعلم الاجتماعي وبتوجيه من المساعد الشخصي
                            </h5>
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="blob_container">
                            <div class="blob left">
                                <img src="images/5.png" alt="how1">
                            </div>
                            <h5>
                                مع الأدوات الفعالة والموارد المتنوعة التي توفرها لك المنصة، وتحفيز المساعد الشخصي
                                بالمتابعة والتوجيه، ستحقق هدفك بجدارة وتبني شبكتك الاجتماعية الداعمة
                            </h5>
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="arrow d-none d-md-block">
                            <img src="images/arrow_left.png" alt="arrow">
                        </div>
                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">

                    </div>

                    <div class="col-lg-6 col-12 p-2 mb-3" data-aos="fade-up">
                        <div class="blob_container">
                            <div class="blob left">
                                <img src="images/6.png" alt="how1">
                            </div>
                            <h5>
                                ولا تنسى أن تقيم تجربتك وتشارك قصة نجاحك مع أصدقائك لتكتسب نقاط خبرة داخل المنصة وتنجز
                                المهام التحفيزية للاستفادة من المزايا المتنوعة
                            </h5>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="about">
            <div class="container">
                <h2 data-aos="fade-up">صممت من أجلك!</h2>

                <div class="row justify-content-center gap-5">
                    <div class="col-lg-4 col-12 p-3" data-aos="fade-up">
                        <div class="inner_card">
                            <h4>كمستفيد</h4>

                            <div class="blob">
                                <img src="images/beneficiary.png" alt="beneficiary">
                            </div>

                            <h5>
                                منصة لا غنى عنها لكل من لديه الرغبة والإرادة لتحقيق أهدافه أو انجاز مهامه بكفاءة وفعالية
                            </h5>
                        </div>
                    </div>


                    <div class="col-lg-4 col-12 p-3" data-aos="fade-up">
                        <div class="inner_card">
                            <h4>كمساعد شخصي</h4>

                            <div class="blob sec">
                                <img src="images/personal_assistant.png" alt="beneficiary">
                            </div>

                            <h5>
                                منصة لا غنى عنها لكل من لديه الرغبة والإرادة لتحقيق أهدافه أو انجاز مهامه بكفاءة وفعالية
                            </h5>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="join_us" id="join">
            <div class="container">
                <div class="row mb-5">
                    <div class="col-12 p-2">
                        <h2 data-aos="fade-up">هل أنت مهتم بالانضمام إلى قائمة مستكشفي النسخة الأولى من "تسامي" عند
                            الاطلاق التجريبي؟</h2>

                        <div class="soon_on" data-aos="fade-up">
                            <h5>قريباً على:</h5>
                            <img src="images/stores.png" alt="">
                        </div>

                        <div class="features" data-aos="fade-up">
                            <h3>سجل اهتمامك بالتجربة الجديدة، وكن من "رواد تسامي" للاستفادة من المزايا الحصرية للنسخة
                                الأولى، وتشمل:</h3>
                            <ul>
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1"
                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" x="0" y="0"
                                        viewBox="0 0 520 520" style="enable-background:new 0 0 512 512"
                                        xml:space="preserve" class="">
                                        <g>
                                            <path
                                                d="M239.987 460.841a10 10 0 0 1-7.343-3.213L34.657 243.463A10 10 0 0 1 42 226.675h95.3a10.006 10.006 0 0 1 7.548 3.439l66.168 76.124c7.151-15.286 20.994-40.738 45.286-71.752 35.912-45.85 102.71-113.281 216.994-174.153a10 10 0 0 1 10.85 16.712c-.436.341-44.5 35.041-95.212 98.6-46.672 58.49-108.714 154.13-139.243 277.6a10 10 0 0 1-9.707 7.6z"
                                                data-name="6-Check" fill="#05CDFF" opacity="1" data-original="#000000"
                                                class=""></path>
                                        </g>
                                    </svg>
                                    الحصول على رصيد شراء في محفظة "المستفيد" بقيمة 750 ريالًا
                                </li>
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1"
                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" x="0" y="0"
                                        viewBox="0 0 520 520" style="enable-background:new 0 0 512 512"
                                        xml:space="preserve" class="">
                                        <g>
                                            <path
                                                d="M239.987 460.841a10 10 0 0 1-7.343-3.213L34.657 243.463A10 10 0 0 1 42 226.675h95.3a10.006 10.006 0 0 1 7.548 3.439l66.168 76.124c7.151-15.286 20.994-40.738 45.286-71.752 35.912-45.85 102.71-113.281 216.994-174.153a10 10 0 0 1 10.85 16.712c-.436.341-44.5 35.041-95.212 98.6-46.672 58.49-108.714 154.13-139.243 277.6a10 10 0 0 1-9.707 7.6z"
                                                data-name="6-Check" fill="#05CDFF" opacity="1" data-original="#000000"
                                                class=""></path>
                                        </g>
                                    </svg>
                                    دورة تأهيلية مجانية للاستفادة المثلى من نموذج العمل الخاص بالمساعد الشخصي
                                </li>
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1"
                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" x="0" y="0"
                                        viewBox="0 0 520 520" style="enable-background:new 0 0 512 512"
                                        xml:space="preserve" class="">
                                        <g>
                                            <path
                                                d="M239.987 460.841a10 10 0 0 1-7.343-3.213L34.657 243.463A10 10 0 0 1 42 226.675h95.3a10.006 10.006 0 0 1 7.548 3.439l66.168 76.124c7.151-15.286 20.994-40.738 45.286-71.752 35.912-45.85 102.71-113.281 216.994-174.153a10 10 0 0 1 10.85 16.712c-.436.341-44.5 35.041-95.212 98.6-46.672 58.49-108.714 154.13-139.243 277.6a10 10 0 0 1-9.707 7.6z"
                                                data-name="6-Check" fill="#05CDFF" opacity="1" data-original="#000000"
                                                class=""></path>
                                        </g>
                                    </svg>
                                    تمييز حسابك بشارة "رواد تسامي" الدائمة ضمن ملفك التعريفي
                                </li>
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1"
                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" x="0" y="0"
                                        viewBox="0 0 520 520" style="enable-background:new 0 0 512 512"
                                        xml:space="preserve" class="">
                                        <g>
                                            <path
                                                d="M239.987 460.841a10 10 0 0 1-7.343-3.213L34.657 243.463A10 10 0 0 1 42 226.675h95.3a10.006 10.006 0 0 1 7.548 3.439l66.168 76.124c7.151-15.286 20.994-40.738 45.286-71.752 35.912-45.85 102.71-113.281 216.994-174.153a10 10 0 0 1 10.85 16.712c-.436.341-44.5 35.041-95.212 98.6-46.672 58.49-108.714 154.13-139.243 277.6a10 10 0 0 1-9.707 7.6z"
                                                data-name="6-Check" fill="#05CDFF" opacity="1" data-original="#000000"
                                                class=""></path>
                                        </g>
                                    </svg>
                                    اشتراك مساعد شخصي مميز ومجاني مع دعم متواصل لمدة 12 شهراً
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6 col-12 p-2" data-aos="fade-up">
                        <h6>سجل اهتمامك بخطوة واحدة:</h6>

                        <form id="interestForm">
                            <div class="form-group mb-2">
                                <label for="name">الاسم الكامل</label>
                                <input type="text" class="form-control" id="name" placeholder="أدخل اسمك الكامل"
                                    required>
                            </div>

                            <div class="form-group mb-2">
                                <label for="email">البريد الإلكتروني</label>
                                <input type="email" class="form-control" id="email" placeholder="أدخل بريدك الإلكتروني"
                                    required>
                            </div>

                            <div class="form-group mb-2">
                                <label for="country">الدولة</label>
                                <select id="country" required>
                                    <option value="">اختر الدولة</option>
                                    <option value="السعودية">السعودية</option>
                                    <option value="الإمارات">الإمارات</option>
                                    <option value="مصر">مصر</option>
                                    <option value="المغرب">المغرب</option>
                                    <option value="الجزائر">الجزائر</option>
                                    <option value="الكويت">الكويت</option>
                                    <option value="سلطنة عمان">سلطنة عمان</option>
                                    <option value="قطر">قطر</option>
                                    <option value="العراق">العراق</option>
                                    <option value="الأردن">الأردن</option>
                                    <option value="سوريا">سوريا</option>
                                    <option value="لبنان">لبنان</option>
                                    <option value="فلسطين">فلسطين</option>
                                    <option value="السودان">السودان</option>
                                    <option value="ليبيا">ليبيا</option>
                                    <option value="تونس">تونس</option>
                                    <option value="موريتانيا">موريتانيا</option>
                                    <option value="اليمن">اليمن</option>
                                    <option value="الصومال">الصومال</option>
                                    <option value="جيبوتي">جيبوتي</option>
                                    <option value="جزر القمر">جزر القمر</option>
                                    <!-- Add other countries here -->
                                </select>
                            </div>

                            <div class="form-group mb-2">
                                <label for="city">المدينه</label>
                                <select id="city" required></select>
                                <span>إذا لم تكن مدينتك مدرجة، اختر أقرب مدينة إلى مكان إقامتك الفعلي</span>
                            </div>

                            <button>التسجيل</button>
                        </form>
                    </div>

                    <div class="col-lg-6 col-12 p-2" data-aos="fade-up">
                        <div class="w-100 h-100 p-3 rounded" style="min-height: 450px;" id="map"></div>
                    </div>

                    <div class="col-12 p-2">
                        <div class="top-countries">
                            <strong>أعلى 10 دول تسجيلاً:</strong>
                            <ol id="countryList"></ol>
                        </div>
                        <div class="loader" id="loader"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="follow">
            <h2>كن قريباً من الحدث. تابعنا:</h2>
            <div class="socials">
                <a href="">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="32" height="32" x="0" y="0" viewBox="0 0 512.001 512.001"
                        style="enable-background:new 0 0 512 512" xml:space="preserve" class="">
                        <g>
                            <path
                                d="M373.406 0H138.594C62.172 0 0 62.172 0 138.594V373.41C0 449.828 62.172 512 138.594 512H373.41C449.828 512 512 449.828 512 373.41V138.594C512 62.172 449.828 0 373.406 0zm108.578 373.41c0 59.867-48.707 108.574-108.578 108.574H138.594c-59.871 0-108.578-48.707-108.578-108.574V138.594c0-59.871 48.707-108.578 108.578-108.578H373.41c59.867 0 108.574 48.707 108.574 108.578zm0 0"
                                fill="#fff" opacity="1" data-original="#fff" class=""></path>
                            <path
                                d="M256 116.004c-77.195 0-139.996 62.8-139.996 139.996S178.804 395.996 256 395.996 395.996 333.196 395.996 256 333.196 116.004 256 116.004zm0 249.976c-60.64 0-109.98-49.335-109.98-109.98 0-60.64 49.34-109.98 109.98-109.98 60.645 0 109.98 49.34 109.98 109.98 0 60.645-49.335 109.98-109.98 109.98zM399.344 66.285c-22.813 0-41.367 18.559-41.367 41.367 0 22.813 18.554 41.371 41.367 41.371s41.37-18.558 41.37-41.37-18.558-41.368-41.37-41.368zm0 52.719c-6.258 0-11.352-5.094-11.352-11.352 0-6.261 5.094-11.351 11.352-11.351 6.261 0 11.355 5.09 11.355 11.351 0 6.258-5.094 11.352-11.355 11.352zm0 0"
                                fill="#fff" opacity="1" data-original="#fff" class=""></path>
                        </g>
                    </svg>
                </a>
                <a href="">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="32" height="32" x="0" y="0" viewBox="0 0 1226.37 1226.37"
                        style="enable-background:new 0 0 512 512" xml:space="preserve" class="">
                        <g>
                            <path
                                d="M727.348 519.284 1174.075 0h-105.86L680.322 450.887 370.513 0H13.185l468.492 681.821L13.185 1226.37h105.866l409.625-476.152 327.181 476.152h357.328L727.322 519.284zM582.35 687.828l-47.468-67.894-377.686-540.24H319.8l304.797 435.991 47.468 67.894 396.2 566.721H905.661L582.35 687.854z"
                                fill="#FFFFFF" opacity="1" data-original="#fff"></path>
                        </g>
                    </svg>
                </a>
            </div>

        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/leaflet.js"></script>

    <script>
        // Fetch CSRF token when page loads
        document.addEventListener('DOMContentLoaded', function () {
            // Fetch CSRF token
            fetch('/csrf-token')
                .then(response => response.json())
                .then(data => {
                    document.querySelector('meta[name="csrf-token"]').setAttribute('content', data.token);
                })
                .catch(error => console.error('Error fetching CSRF token:', error));

            // Fetch registered users and display them on the map
            fetch('/registered-users')
                .then(response => response.json())
                .then(users => {
                    displayRegisteredUsers(users);
                })
                .catch(error => console.error('Error fetching registered users:', error));
        });
    </script>

    <script>
        const map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        const countryCounts = {};
        const countryMarkers = {};
        const registeredEmails = new Set();
        const registeredIPs = new Set();
        const countryListEl = document.getElementById('countryList');

        // Function to display registered users on the map
        async function displayRegisteredUsers(users) {
            // Clear existing markers and country counts
            for (const country in countryMarkers) {
                map.removeLayer(countryMarkers[country]);
                delete countryMarkers[country];
            }

            // Reset country counts
            Object.keys(countryCounts).forEach(key => delete countryCounts[key]);

            // Process the top countries data from the controller
            for (const userData of users) {
                const { country, city, count } = userData;

                // Update country counts for display
                countryCounts[country] = count;

                // Get coordinates for the city and country
                try {
                    const geoRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city + ', ' + country)}`);
                    const geoData = await geoRes.json();

                    if (geoData.length > 0) {
                        const lat = parseFloat(geoData[0].lat);
                        const lon = parseFloat(geoData[0].lon);

                        // Create a custom icon with the count displayed
                        const customIcon = L.divIcon({
                            className: 'custom-div-icon',
                            html: `<div style="background-color: #004AAD; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; font-weight: bold;">${count}</div>`,
                            iconSize: [40, 40],
                            iconAnchor: [20, 20]
                        });

                        const marker = L.marker([lat, lon], {
                            icon: customIcon
                        }).addTo(map);

                        marker.bindPopup(`${country}: ${count} مشارك`);
                        countryMarkers[country] = marker;
                    }
                } catch (error) {
                    console.error('Error geocoding location:', error);
                }
            }

            // Update the country list
            updateCountryList();
        }

        const citiesByCountry = {
            "السعودية": ["الرياض", "جدة", "الدمام", "المدينة المنورة", "مكة", "تبوك", "أبها", "بريدة", "الطائف", "الخبر", "حائل", "جيزان", "ينبع", "عرعر", "نجران", "سكاكا", "الجبيل", "القريات", "بيشة", "الرس"],
            "الإمارات": ["دبي", "أبو ظبي", "الشارقة", "العين", "رأس الخيمة", "عجمان", "الفجيرة", "أم القيوين", "خورفكان", "دبا الفجيرة", "مدينة زايد", "الذيد", "ليوا", "مصفوت", "دبا الحصن", "غياثي", "السلع", "دلما", "الرملة", "بدع زايد"],
            "مصر": ["القاهرة", "الجيزة", "الإسكندرية", "المنصورة", "السويس", "طنطا", "أسوان", "الأقصر", "أسيوط", "الزقازيق", "بنها", "دمياط", "بورسعيد", "كفر الشيخ", "قنا", "الفيوم", "شبين الكوم", "العريش", "العاشر من رمضان", "المنيا"],
            "المغرب": ["الدار البيضاء", "الرباط", "فاس", "مراكش", "طنجة", "أكادير", "مكناس", "وجدة", "تطوان", "القنيطرة", "الجديدة", "بركان", "آسفي", "الناظور", "خريبكة", "سلا", "بني ملال", "تازة", "تمارة", "الصويرة"],
            "الجزائر": ["الجزائر العاصمة", "وهران", "قسنطينة", "سطيف", "عنابة", "باتنة", "بلعباس", "بجاية", "تلمسان", "الجلفة", "بسكرة", "الأغواط", "تيزي وزو", "الشلف", "تبسة", "تيارت", "قالمة", "غرداية", "البويرة", "برج بوعريريج"],
            "البحرين": ["المنامة", "المحرق", "الرفاع", "عيسى تاون", "مدينة حمد", "مدينة زايد", "سترة", "جد حفص", "البديع", "سار", "الحد", "سنابس", "باربار", "الدراز", "جنوسان", "دمستان", "بني جمرة", "كرزكان", "المالكية", "البلاد القديم"],
            "الكويت": ["الكويت", "حولي", "الفروانية", "الأحمدي", "الجهراء", "مبارك الكبير", "السالمية", "الرقة", "المنقف", "الفحيحيل", "العاصمة", "الدوحة", "العارضية", "العبدلي", "الصباحية", "أم الهيمان", "خيطان", "جليب الشيوخ", "الصليبية", "سلوى"],
            "سلطنة عمان": ["مسقط", "صلالة", "صحار", "نزوى", "البريمي", "صور", "إبراء", "بهلاء", "الرستاق", "بركاء", "عبري", "خصب", "السيب", "قريات", "المضيبي", "جعلان بني بوعلي", "شناص", "مدحاء", "بدبد", "الدقم"],
            "قطر": ["الدوحة", "الريان", "الوكرة", "أم صلال", "الخور", "الشحانية", "مسيعيد", "الظعاين", "الغويرية", "لوسيل", "أم باب", "روضة راشد", "دخان", "الجميلية", "أم غويلينة", "فريج عبد العزيز", "العزيزية", "المعمورة", "المطار القديم", "الثمامة"],
            "العراق": ["بغداد", "البصرة", "أربيل", "الموصل", "النجف", "كركوك", "السليمانية", "كربلاء", "الرمادي", "الناصرية", "الديوانية", "العمارة", "الحلة", "سامراء", "ديالى", "تكريت", "دهوك", "الكوت", "عفك", "الرطبة"],
            "الأردن": ["عمان", "الزرقاء", "إربد", "العقبة", "الرمثا", "الكرك", "المفرق", "مأدبا", "جرش", "السلط", "معان", "الطفيلة", "دير علا", "البتراء", "الرصيفة", "الهاشمية", "الصريح", "الزعتري", "عجلون", "الشنانة"],
            "سوريا": ["دمشق", "حلب", "حمص", "اللاذقية", "طرطوس", "حماة", "دير الزور", "الرقة", "السويداء", "درعا", "القنيطرة", "إدلب", "النبك", "جبلة", "صافيتا", "القرداحة", "معرة النعمان", "منبج", "تل أبيض", "الميادين"],
            "لبنان": ["بيروت", "طرابلس", "صيدا", "صور", "زحلة", "جونية", "جبيل", "بعلبك", "النبطية", "عاليه", "بعقلين", "بشري", "دير القمر", "الدامور", "بيت الدين", "الحدث", "الضنية", "راشيا", "رميش", "طرابلس الميناء"],
            "فلسطين": ["غزة", "رام الله", "نابلس", "الخليل", "جنين", "بيت لحم", "طولكرم", "قلقيلية", "سلفيت", "أريحا", "القدس", "رفح", "خان يونس", "دير البلح", "جباليا", "بيت حانون", "بيت لاهيا", "بني سهيلا", "الزوايدة", "الوسطى"],
            "السودان": ["الخرطوم", "أم درمان", "بحري", "بورتسودان", "كسلا", "ود مدني", "الأبيض", "سنار", "كادوقلي", "عطبرة", "دنقلا", "الفاشر", "نيالا", "القضارف", "الدمازين", "كوستي", "ربك", "سواكن", "الجنينة", "زالنجي"],
            "ليبيا": ["طرابلس", "بنغازي", "مصراتة", "الزاوية", "سبها", "الخمس", "البيضاء", "ترهونة", "درنة", "طبرق", "زليتن", "زنتان", "اجدابيا", "بني وليد", "غريان", "صرمان", "سرت", "المرج", "الرجبان", "هون"],
            "تونس": ["تونس", "صفاقس", "سوسة", "القيروان", "بنزرت", "قابس", "قفصة", "مدنين", "المهدية", "نابل", "تطاوين", "زغوان", "منوبة", "أريانة", "سيدي بوزيد", "الكاف", "جندوبة", "قبلي", "توزر", "باجة"],
            "موريتانيا": ["نواكشوط", "نواذيبو", "روصو", "أطار", "كيفه", "كيهيدي", "سيلبابي", "ألاك", "بوكيه", "تجكجة", "تمبدغة", "النعمة", "بير أم اكرين", "أوجفت", "شنقيط", "وادان", "أكجوجت", "المجرية", "كوبني", "بوتلميت"],
            "اليمن": ["صنعاء", "عدن", "تعز", "الحديدة", "إب", "المكلا", "سيئون", "ذمار", "البيضاء", "حجة", "المحويت", "صعدة", "شبوة", "لحج", "مارب", "الضالع", "ريمة", "الجوف", "باجل", "زنجبار"],
            "الصومال": ["مقديشو", "هرجيسا", "بوصاصو", "جالكعيو", "بلدوين", "كيسمايو", "براوة", "مركا", "بيراوا", "غروي", "لاسعانود", "بوراو", "بلعد", "عدالي", "عيل بور", "هارجابو", "بربرة", "عيل عدي", "دوسمريب", "عيل طيري"],
            "جيبوتي": ["جيبوتي", "تاجورة", "علي صبيح", "دخيل", "أوبوك", "هول هول", "بلحو", "ياغوري", "داي ديماي", "آلي صبيح", "دورا", "راهون", "غوبكا", "أركا", "شبيلي", "حنلي", "وهر", "أسّامو", "بوندرا", "لوبيا"],
            "جزر القمر": ["موروني", "متساميولي", "فومبوني", "دمبني", "إيتسيامي", "تسيدجوي", "نجازيدجا", "موتسامودو", "أواني", "سيما", "تشيوي", "إكوني", "أوياني", "نمباو", "فوادجو", "فومووني", "بوامباو", "كوانبويني", "هامباو", "نيومو"],
        };

        document.getElementById('country').addEventListener('change', function () {
            const cities = citiesByCountry[this.value] || [];
            const citySelect = document.getElementById('city');
            citySelect.innerHTML = '<option value="">اختر المدينة</option>';
            cities.forEach(city => {
                citySelect.innerHTML += `<option value="${city}">${city}</option>`;
            });
        });

        function updateCountryList() {
            const sorted = Object.entries(countryCounts).sort((a, b) => b[1] - a[1]).slice(0, 10);
            countryListEl.innerHTML = '';
            sorted.forEach(([country, count]) => {
                countryListEl.innerHTML += `<li>${country}: ${count}</li>`;
            });
        }

        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return null;
            }
        }

        // document.getElementById('interestForm').addEventListener('submit', async (e) => {
        //     e.preventDefault();
        //     const name = document.querySelector('input[name="name"]').value.trim();
        //     const email = document.getElementById('email').value.trim();
        //     const country = document.getElementById('country').value;
        //     const city = document.getElementById('city').value;
        //     const ip = await getUserIP();
        //
        //     if (registeredEmails.has(email)) return alert("تم تسجيل هذا البريد الإلكتروني مسبقًا.");
        //     if (ip && registeredIPs.has(ip)) return alert("تم التسجيل مسبقًا من هذا الجهاز.");
        //
        //     registeredEmails.add(email);
        //     if (ip) registeredIPs.add(ip);
        //
        //     countryCounts[country] = (countryCounts[country] || 0) + 1;
        //     updateCountryList();
        //
        //     const message = `• الاسم: ${name}\n• البريد الإلكتروني: ${email}\n• الدولة: ${country}\n• المدينة: ${city}\n• عنوان IP: ${ip}`;
        //     fetch('https://formsubmit.co/ajax/smeshabbi@gmail.com', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        //         body: JSON.stringify({ name, email, message })
        //     });
        //
        //     // Show on map
        //     const geoRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city + ', ' + country)}`);
        //     const geoData = await geoRes.json();
        //     if (geoData.length > 0) {
        //         const lat = parseFloat(geoData[0].lat);
        //         const lon = parseFloat(geoData[0].lon);
        //         if (countryMarkers[country]) map.removeLayer(countryMarkers[country]);
        //         const marker = L.circleMarker([lat, lon], {
        //             radius: 20,
        //             color: '#004AAD',
        //             fillColor: '#004AAD',
        //             fillOpacity: 0.5
        //         }).addTo(map);
        //         marker.bindPopup(`${country}: ${countryCounts[country]} مشارك`).openPopup();
        //         countryMarkers[country] = marker;
        //         map.setView([lat, lon], 5);
        //     }
        //
        //     alert("تم التسجيل بنجاح!");
        // });
    </script>

    <script>
        document.getElementById('interestForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const loader = document.getElementById('loader');
            loader.style.display = 'block'; // Show loader

            const name = document.querySelector('input[name="name"]').value.trim();
            const email = document.getElementById('email').value.trim();
            const country = document.getElementById('country').value;
            const city = document.getElementById('city').value;
            const ip = await getUserIP();

            if (registeredEmails.has(email)) {
                loader.style.display = 'none'; // Hide loader
                return alert("تم تسجيل هذا البريد الإلكتروني مسبقًا.");
            }
            if (ip && registeredIPs.has(ip)) {
                loader.style.display = 'none'; // Hide loader
                return alert("تم التسجيل مسبقًا من هذا الجهاز.");
            }
            registeredEmails.add(email);
            if (ip) registeredIPs.add(ip);

            countryCounts[country] = (countryCounts[country] || 0) + 1;
            updateCountryList();

            const message = `• الاسم: ${name}\n• البريد الإلكتروني: ${email}\n• الدولة: ${country}\n• المدينة: ${city}\n• عنوان IP: ${ip}`;

            // إرسال البيانات إلى الـ API
            fetch('/interest-form', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({ name, email, country, city, ip })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        loader.style.display = 'none'; // Hide loader
                        alert(data.message);

                        // Refresh the top 10 countries from the server
                        fetch('/registered-users')
                            .then(response => response.json())
                            .then(users => {
                                displayRegisteredUsers(users);
                            })
                            .catch(error => console.error('Error fetching registered users:', error));
                    }
                })
                .catch(error => {
                    loader.style.display = 'none'; // Hide loader
                    console.error('Error:', error);
                });

            // Show on map
            const geoRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city + ', ' + country)}`);
            const geoData = await geoRes.json();
            if (geoData.length > 0) {
                const lat = parseFloat(geoData[0].lat);
                const lon = parseFloat(geoData[0].lon);
                if (countryMarkers[country]) map.removeLayer(countryMarkers[country]);
                // Create a custom icon with the count displayed
                const customIcon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div style="background-color: #004AAD; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; font-weight: bold;">${countryCounts[country]}</div>`,
                    iconSize: [40, 40],
                    iconAnchor: [20, 20]
                });

                const marker = L.marker([lat, lon], {
                    icon: customIcon
                }).addTo(map);

                marker.bindPopup(`${country}: ${countryCounts[country]} مشارك`).openPopup();
                countryMarkers[country] = marker;
                map.setView([lat, lon], 5);
            }
        });
    </script>
</body>


</html>